{# templates/includes/navbar.html #}
<header class="navbar">
  <!-- ðŸ‘‡ padding forzado en el contenedor interno -->
  <div class="container nav-inner" style="padding-left:28px; padding-right:20px;">
    <a class="brand" href="{% url 'rutas:list' %}">
      <!-- ðŸ‘‡ margen forzado en el punto -->
      <span class="dot" style="margin-left:8px; margin-right:8px; transform:translateY(1px);"></span>
      <span>AcarreApp</span>
      {% if empresa_actual %}
        <span class="empresa">Â· {{ empresa_actual.nombre }}</span>
      {% endif %}
    </a>

    {% if request.user.is_authenticated %}
      {% with rol=request.user.userprofile.rol|default_if_none:'' %}
        {% if request.user.is_superuser or request.user.is_staff or rol == 'GERENTE' %}
          <nav class="nav main-nav" aria-label="NavegaciÃ³n principal">
            <a href="{% url 'rutas:list' %}">Rutas</a>
            <a href="{% url 'empresa:clientes_list' %}">Clientes</a>
            <a href="{% url 'dashboard:home' %}">Dashboard</a>
          </nav>
        {% else %}
          <nav class="nav main-nav" aria-label="NavegaciÃ³n principal">
            <a href="{% url 'rutas:list' %}">Rutas</a>
          </nav>
        {% endif %}

        <div class="menu-right">
          <button class="userchip" id="userchip" aria-haspopup="true" aria-expanded="false">
            <span class="avatar">{{ request.user.get_full_name|default:request.user.username|first|upper }}</span>
            <span class="meta">
              <span class="name">{{ request.user.get_full_name|default:request.user.username }}</span>
              {% if rol %}<span class="role">{{ rol|title }}</span>{% endif %}
            </span>
            <span class="caret">â–¾</span>
          </button>

          <div class="dropdown" id="userdropdown" hidden role="menu">
            <form method="post" action="{% url 'logout' %}" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn btn-link p-0">Salir</button>
            </form>
          </div>
        </div>
      {% endwith %}
    {% else %}
      <nav class="nav main-nav" aria-label="NavegaciÃ³n principal">
        <a href="{% url 'login' %}">Iniciar sesiÃ³n</a>
      </nav>
    {% endif %}
  </div>
</header>

<script>
(()=> {
  const chip = document.getElementById('userchip');
  const menu = document.getElementById('userdropdown');
  if (!chip || !menu) return;

  const close = () => { menu.hidden = true; chip.setAttribute('aria-expanded','false'); };
  const toggle = (e) => {
    e.stopPropagation();
    if (menu.hidden) { menu.hidden = false; chip.setAttribute('aria-expanded','true'); }
    else close();
  };

  chip.addEventListener('click', toggle);
  document.addEventListener('click', (e) => {
    if (!menu.hidden && !chip.contains(e.target) && !menu.contains(e.target)) close();
  });
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') close(); });
})();
</script>
